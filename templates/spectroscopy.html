<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atmospheric Spectroscopy - SABRINA</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        .container {
            position: relative;
            z-index: 2;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            border: 2px solid rgba(100, 255, 218, 0.3);
        }
        
        .header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5em;
            color: #64ffda;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(100, 255, 218, 0.5);
        }
        
        .content-card {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            border: 3px solid rgba(100, 255, 218, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .intro-section {
            margin-bottom: 40px;
        }
        
        .intro-section h2 {
            font-family: 'Orbitron', sans-serif;
            color: #f8b500;
            font-size: 1.8em;
            margin-bottom: 15px;
        }
        
        .intro-section p {
            font-size: 1.1em;
            line-height: 1.8;
            color: #b0bec5;
            margin-bottom: 15px;
        }
        
        .spectrum-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid rgba(100, 255, 218, 0.2);
        }
        
        .spectrum-title {
            font-family: 'Orbitron', sans-serif;
            color: #64ffda;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .spectrum-chart {
            position: relative;
            height: 300px;
            background: linear-gradient(90deg, #1a1a2e 0%, #0a0e27 100%);
            border: 2px solid rgba(100, 255, 218, 0.3);
            border-radius: 10px;
            margin: 20px 0;
            overflow: visible;
            padding-top: 30px;
        }
        
        .spectrum-line {
            position: absolute;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to top, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.3));
            transition: all 0.3s;
        }
        
        .absorption-line {
            position: absolute;
            bottom: 0;
            width: 4px;
            background: #ff6b9d;
            border-radius: 2px 2px 0 0;
            box-shadow: 0 0 10px rgba(255, 107, 157, 0.8);
            animation: pulse 2s infinite;
            transition: all 0.3s;
        }
        
        .absorption-line.highlight {
            width: 8px;
            box-shadow: 0 0 20px currentColor;
            z-index: 10;
            animation: flash 1s ease-in-out;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        @keyframes flash {
            0%, 100% { 
                opacity: 1;
                transform: scaleY(1);
            }
            50% { 
                opacity: 1;
                transform: scaleY(1.2);
            }
        }
        
        .wavelength-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9em;
            color: #b0bec5;
        }
        
        .elements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .element-card {
            background: rgba(100, 255, 218, 0.1);
            border: 2px solid rgba(100, 255, 218, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .element-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(100, 255, 218, 0.4);
            border-color: #64ffda;
        }
        
        .element-card.selected {
            background: rgba(100, 255, 218, 0.3);
            border-color: #64ffda;
            box-shadow: 0 0 20px rgba(100, 255, 218, 0.6);
        }
        
        .element-card.correct {
            background: rgba(0, 230, 118, 0.3);
            border-color: #00e676;
        }
        
        .element-card.incorrect {
            background: rgba(255, 107, 157, 0.3);
            border-color: #ff6b9d;
        }
        
        .element-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3em;
            color: #64ffda;
            margin-bottom: 10px;
        }
        
        .element-description {
            font-size: 0.9em;
            color: #b0bec5;
            margin-top: 10px;
        }
        
        .selected-elements {
            margin: 30px 0;
            padding: 20px;
            background: rgba(248, 181, 0, 0.1);
            border-radius: 15px;
            border: 2px solid rgba(248, 181, 0, 0.3);
        }
        
        .selected-elements h3 {
            font-family: 'Orbitron', sans-serif;
            color: #f8b500;
            margin-bottom: 15px;
        }
        
        .selected-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .selected-tag {
            background: rgba(248, 181, 0, 0.3);
            border: 2px solid #f8b500;
            border-radius: 20px;
            padding: 8px 15px;
            font-weight: bold;
            color: #f8b500;
        }
        
        .btn {
            padding: 20px 40px;
            font-size: 1.3em;
            font-weight: bold;
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, #00e676, #00bcd4);
            border: none;
            border-radius: 15px;
            color: #0a0e27;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(0, 230, 118, 0.4);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin: 20px 10px;
            display: inline-block;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 230, 118, 0.6);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #64ffda, #00bcd4);
        }
        
        .feedback {
            margin: 20px 0;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.1em;
            text-align: center;
        }
        
        .feedback.success {
            background: rgba(0, 230, 118, 0.2);
            border: 2px solid #00e676;
            color: #00e676;
        }
        
        .feedback.info {
            background: rgba(100, 255, 218, 0.2);
            border: 2px solid #64ffda;
            color: #64ffda;
        }
        
        .edu-box {
            background: rgba(248, 181, 0, 0.1);
            border-left: 5px solid #f8b500;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .edu-box h3 {
            font-family: 'Orbitron', sans-serif;
            color: #f8b500;
            margin-bottom: 10px;
        }
        
        .edu-box p {
            color: #b0bec5;
            line-height: 1.6;
        }
        
        .assessment-panel {
            margin-top: 40px;
            padding: 30px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            border: 3px solid rgba(100, 255, 218, 0.3);
            display: none;
        }
        
        .assessment-panel.show {
            display: block;
            animation: slideIn 0.5s ease-out;
        }
        
        .assessment-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2em;
            color: #64ffda;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 20px rgba(100, 255, 218, 0.5);
        }
        
        .assessment-findings {
            margin: 20px 0;
        }
        
        .finding-item {
            padding: 15px;
            margin: 10px 0;
            background: rgba(100, 255, 218, 0.1);
            border-left: 4px solid #64ffda;
            border-radius: 8px;
            font-size: 1.1em;
        }
        
        .conclusion-box {
            padding: 25px;
            margin: 25px 0;
            border-radius: 15px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .conclusion-box.habitable {
            background: rgba(0, 230, 118, 0.2);
            border: 3px solid #00e676;
            color: #00e676;
        }
        
        .conclusion-box.moderate {
            background: rgba(248, 181, 0, 0.2);
            border: 3px solid #f8b500;
            color: #f8b500;
        }
        
        .conclusion-box.uninhabitable {
            background: rgba(255, 107, 157, 0.2);
            border: 3px solid #ff6b9d;
            color: #ff6b9d;
        }
        
        .recommendation-box {
            padding: 20px;
            margin: 20px 0;
            background: rgba(100, 255, 218, 0.15);
            border: 2px solid rgba(100, 255, 218, 0.4);
            border-radius: 12px;
            font-size: 1.1em;
            line-height: 1.6;
        }
        
        .category-badge {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin: 5px;
        }
        
        .badge-habitable {
            background: rgba(0, 230, 118, 0.3);
            color: #00e676;
            border: 2px solid #00e676;
        }
        
        .badge-temperature {
            background: rgba(100, 255, 218, 0.3);
            color: #64ffda;
            border: 2px solid #64ffda;
        }
        
        .badge-poisonous {
            background: rgba(255, 107, 157, 0.3);
            color: #ff6b9d;
            border: 2px solid #ff6b9d;
        }
        
        .badge-greenhouse {
            background: rgba(248, 181, 0, 0.3);
            color: #f8b500;
            border: 2px solid #f8b500;
        }
    </style>
</head>
<body>
    <!-- Animated Starfield -->
    <div class="stars" id="stars"></div>
    
    <div class="container">
        <div class="header">
            <h1>üî¨ Atmospheric Composition Spectroscopy</h1>
            <p style="font-size: 1.2em; color: #b0bec5;">Analyze the light spectrum to identify elements in {{ state.target_planet_data.name if state.target_planet_data else 'the planet' }}'s atmosphere!</p>
        </div>
        
        <div class="content-card">
            <div class="intro-section">
                <h2>üåå What is Spectroscopy?</h2>
                <p>
                    Spectroscopy is a powerful tool scientists use to study the composition of distant planets! 
                    When light from a star passes through a planet's atmosphere, different elements absorb light at specific wavelengths, 
                    creating "absorption lines" in the spectrum.
                </p>
                <p>
                    <strong>Your Mission:</strong> Analyze the spectrum below and identify which elements are present in 
                    <strong>{{ state.target_planet_data.name if state.target_planet_data else 'this planet' }}</strong>'s atmosphere!
                </p>
            </div>
            
            <div class="edu-box">
                <h3>üí° How It Works</h3>
                <p>
                    Each element has unique "fingerprint" wavelengths where it absorbs light. The dark lines (dips) in the spectrum 
                    show where elements are absorbing light. Match the absorption lines to the element reference cards below!
                </p>
            </div>
            
            {% if spectroscopy_data %}
            <div class="spectrum-container">
                <div class="spectrum-title">üìä Light Spectrum from {{ state.target_planet_data.name if state.target_planet_data else 'Planet' }}</div>
                <div class="spectrum-chart" id="spectrumChart">
                    <!-- Spectrum will be drawn here by JavaScript -->
                </div>
                <div class="wavelength-labels">
                    <span>300 nm</span>
                    <span>600 nm</span>
                    <span>900 nm</span>
                    <span>1200 nm</span>
                </div>
            </div>
            
            <div class="selected-elements">
                <h3>‚úÖ Your Selections:</h3>
                <div class="selected-list" id="selectedList">
                    <span style="color: #b0bec5;">No elements selected yet. Click on element cards below!</span>
                </div>
            </div>
            
            <div class="elements-grid">
                {% for element_name, element_data in elements_data.items() %}
                <div class="element-card" data-element="{{ element_name }}" onclick="selectElement('{{ element_name }}')">
                    <div class="element-name">{{ element_name }}</div>
                    <div style="font-size: 0.9em; color: #64ffda; margin: 10px 0;">
                        Wavelengths: {{ element_data.wavelengths|join(', ') }} nm
                    </div>
                    <div class="element-description">{{ element_data.description }}</div>
                </div>
                {% endfor %}
            </div>
            
            <div id="feedback" class="feedback info" style="display: none;">
                <!-- Feedback will appear here -->
            </div>
            
            <!-- Data Assessment Panel -->
            <div id="assessmentPanel" class="assessment-panel">
                <div class="assessment-title">üìä Atmospheric Data Assessment</div>
                
                <div class="edu-box">
                    <h3>üî¨ Scientific Analysis</h3>
                    <p>
                        Based on the elements you identified, we can now assess the planet's characteristics 
                        and potential for human habitation. Each element tells us something important!
                    </p>
                </div>
                
                <div id="assessmentFindings" class="assessment-findings">
                    <!-- Findings will be populated by JavaScript -->
                </div>
                
                <div id="assessmentConclusion" class="conclusion-box">
                    <!-- Conclusion will be populated by JavaScript -->
                </div>
                
                <div id="assessmentRecommendation" class="recommendation-box">
                    <!-- Recommendation will be populated by JavaScript -->
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <form method="POST" action="{{ url_for('spectroscopy_complete') }}" style="display: inline;">
                        <button type="submit" class="btn">‚úÖ Complete Analysis & Continue Mission</button>
                    </form>
                    <a href="{{ url_for('home') }}" class="btn btn-secondary" style="margin-left: 15px;">‚Üê Back to Mission</a>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="checkAnswers()">üîç Analyze Spectrum</button>
                <a href="{{ url_for('home') }}" class="btn btn-secondary">‚Üê Back to Mission</a>
            </div>
            {% else %}
            <div class="feedback info">
                Unable to load spectroscopy data. Please return to the mission.
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <a href="{{ url_for('home') }}" class="btn btn-secondary">‚Üê Back to Mission</a>
            </div>
            {% endif %}
        </div>
    </div>
    
    <script>
        // Create animated starfield
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const numStars = 150;
            for (let i = 0; i < numStars; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 3 + 1;
                star.style.width = size + 'px';
                star.style.height = size + 'px';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = (Math.random() * 3 + 2) + 's';
                starsContainer.appendChild(star);
            }
        }
        
        // Spectroscopy data from backend
        const spectrumData = {{ spectroscopy_data.spectrum|tojson if spectroscopy_data else '[]' }};
        const correctElements = {{ spectroscopy_data.elements|tojson if spectroscopy_data else '[]' }};
        const selectedElements = [];
        
        // Draw spectrum
        function drawSpectrum() {
            const chart = document.getElementById('spectrumChart');
            if (!chart || spectrumData.length === 0) return;
            
            chart.innerHTML = '';
            const chartWidth = chart.offsetWidth - 20;
            const chartHeight = chart.offsetHeight - 20;
            const minWavelength = 300;
            const maxWavelength = 1200;
            
            // Draw spectrum lines
            spectrumData.forEach((point, index) => {
                const x = ((point.wavelength - minWavelength) / (maxWavelength - minWavelength)) * chartWidth;
                const height = (point.intensity / 100) * chartHeight;
                
                const line = document.createElement('div');
                line.className = 'spectrum-line';
                line.style.left = x + 'px';
                line.style.height = height + 'px';
                line.style.opacity = point.intensity / 100;
                chart.appendChild(line);
            });
            
            // Draw absorption lines (darker areas)
            const elementsData = {{ elements_data|tojson }};
            const correctElementsList = {{ spectroscopy_data.elements|tojson if spectroscopy_data else '[]' }};
            
            correctElementsList.forEach(elementName => {
                if (elementsData[elementName]) {
                    const wavelengths = elementsData[elementName].wavelengths;
                    const color = elementsData[elementName].color;
                    
                    wavelengths.forEach(wl => {
                        const x = ((wl - minWavelength) / (maxWavelength - minWavelength)) * chartWidth;
                        const absLine = document.createElement('div');
                        absLine.className = 'absorption-line';
                        absLine.style.left = (x - 2) + 'px';
                        absLine.style.height = chartHeight + 'px';
                        absLine.style.backgroundColor = color;
                        chart.appendChild(absLine);
                    });
                }
            });
        }
        
        function selectElement(elementName) {
            const card = document.querySelector(`[data-element="${elementName}"]`);
            const index = selectedElements.indexOf(elementName);
            
            if (index > -1) {
                // Deselect
                selectedElements.splice(index, 1);
                card.classList.remove('selected');
                highlightElementLines(elementName, false);
            } else {
                // Select
                selectedElements.push(elementName);
                card.classList.add('selected');
                highlightElementLines(elementName, true);
            }
            
            updateSelectedList();
        }
        
        function highlightElementLines(elementName, show) {
            const elementsData = {{ elements_data|tojson }};
            const elementData = elementsData[elementName];
            
            if (!elementData) return;
            
            const chart = document.getElementById('spectrumChart');
            const chartWidth = chart.offsetWidth - 20;
            const chartHeight = chart.offsetHeight - 20;
            const minWavelength = 300;
            const maxWavelength = 1200;
            
            // Remove existing highlight lines for this element
            const existingHighlights = chart.querySelectorAll(`[data-highlight-element="${elementName}"]`);
            existingHighlights.forEach(line => line.remove());
            
            if (show) {
                // Create highlight lines for this element
                elementData.wavelengths.forEach(wl => {
                    const x = ((wl - minWavelength) / (maxWavelength - minWavelength)) * chartWidth;
                    const highlightLine = document.createElement('div');
                    highlightLine.className = 'absorption-line highlight';
                    highlightLine.style.left = (x - 4) + 'px';
                    highlightLine.style.height = chartHeight + 'px';
                    highlightLine.style.backgroundColor = elementData.color;
                    highlightLine.style.borderColor = elementData.color;
                    highlightLine.setAttribute('data-highlight-element', elementName);
                    highlightLine.style.boxShadow = `0 0 25px ${elementData.color}, 0 0 15px ${elementData.color}`;
                    chart.appendChild(highlightLine);
                    
                    // Add wavelength label above the line
                    const label = document.createElement('div');
                    label.style.position = 'absolute';
                    label.style.left = (x - 20) + 'px';
                    label.style.top = '5px';
                    label.style.color = elementData.color;
                    label.style.fontSize = '0.75em';
                    label.style.fontWeight = 'bold';
                    label.style.fontFamily = 'Orbitron, sans-serif';
                    label.style.textShadow = `0 0 10px ${elementData.color}`;
                    label.style.whiteSpace = 'nowrap';
                    label.textContent = wl + 'nm';
                    label.setAttribute('data-highlight-element', elementName);
                    chart.appendChild(label);
                });
                
                // Auto-remove highlights after 2 seconds
                setTimeout(() => {
                    const highlights = chart.querySelectorAll(`[data-highlight-element="${elementName}"]`);
                    highlights.forEach(line => {
                        line.style.transition = 'opacity 0.5s';
                        line.style.opacity = '0';
                        setTimeout(() => line.remove(), 500);
                    });
                }, 2000);
            }
        }
        
        function updateSelectedList() {
            const list = document.getElementById('selectedList');
            if (selectedElements.length === 0) {
                list.innerHTML = '<span style="color: #b0bec5;">No elements selected yet. Click on element cards above!</span>';
            } else {
                list.innerHTML = selectedElements.map(el => 
                    `<span class="selected-tag">${el}</span>`
                ).join('');
            }
        }
        
        function checkAnswers() {
            const feedback = document.getElementById('feedback');
            const assessmentPanel = document.getElementById('assessmentPanel');
            const correctCount = selectedElements.filter(el => correctElements.includes(el)).length;
            const incorrectCount = selectedElements.filter(el => !correctElements.includes(el)).length;
            const missingCount = correctElements.filter(el => !selectedElements.includes(el)).length;
            
            // Mark cards
            document.querySelectorAll('.element-card').forEach(card => {
                const element = card.getAttribute('data-element');
                card.classList.remove('correct', 'incorrect');
                if (correctElements.includes(element)) {
                    if (selectedElements.includes(element)) {
                        card.classList.add('correct');
                    }
                } else if (selectedElements.includes(element)) {
                    card.classList.add('incorrect');
                }
            });
            
            if (correctCount === correctElements.length && incorrectCount === 0 && missingCount === 0) {
                feedback.className = 'feedback success';
                feedback.innerHTML = `
                    <strong>üéâ Excellent Work!</strong><br>
                    You correctly identified all elements in the atmosphere!<br>
                    <strong>Found:</strong> ${correctElements.join(', ')}<br><br>
                    <strong>Scroll down to see the data assessment!</strong>
                `;
                feedback.style.display = 'block';
                
                // Show assessment panel
                showAssessment(selectedElements);
            } else {
                feedback.className = 'feedback info';
                let message = '<strong>üìä Analysis Results:</strong><br>';
                message += `‚úÖ Correct: ${correctCount}/${correctElements.length}<br>`;
                if (incorrectCount > 0) {
                    message += `‚ùå Incorrect selections: ${incorrectCount}<br>`;
                }
                if (missingCount > 0) {
                    message += `‚ö†Ô∏è Missing: ${missingCount} element(s) not identified<br>`;
                }
                message += '<br>üí° Tip: Look at the dark absorption lines in the spectrum and match them to the element wavelengths!';
                message += '<br><br>üí° <strong>Try to identify all correct elements to see the full data assessment!</strong>';
                feedback.innerHTML = message;
                feedback.style.display = 'block';
                assessmentPanel.classList.remove('show');
            }
        }
        
        function showAssessment(identifiedElements) {
            const assessmentPanel = document.getElementById('assessmentPanel');
            const findingsDiv = document.getElementById('assessmentFindings');
            const conclusionDiv = document.getElementById('assessmentConclusion');
            const recommendationDiv = document.getElementById('assessmentRecommendation');
            
            // Get assessment data from backend (we'll simulate it in JavaScript)
            const elementsData = {{ elements_data|tojson }};
            const assessment = assessAtmosphere(identifiedElements, elementsData);
            
            // Display findings
            findingsDiv.innerHTML = '<h3 style="color: #64ffda; margin-bottom: 15px; font-family: Orbitron, sans-serif;">üîç Key Findings:</h3>';
            assessment.findings.forEach(finding => {
                const findingItem = document.createElement('div');
                findingItem.className = 'finding-item';
                findingItem.innerHTML = finding;
                findingsDiv.appendChild(findingItem);
            });
            
            // Display conclusion
            conclusionDiv.className = 'conclusion-box ' + assessment.conclusionClass;
            conclusionDiv.innerHTML = assessment.conclusion;
            
            // Display recommendation
            recommendationDiv.innerHTML = `<strong>üí° Mission Recommendation:</strong><br><br>${assessment.recommendation}`;
            
            // Show the panel
            assessmentPanel.classList.add('show');
            
            // Scroll to assessment
            setTimeout(() => {
                assessmentPanel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 300);
        }
        
        function assessAtmosphere(elements, elementsData) {
            let habitabilityScore = 0;
            const findings = [];
            let hasOxygen = false;
            let hasWater = false;
            let hasMethane = false;
            let hasNitrogen = false;
            let hasSulfurDioxide = false;
            let hasCarbonDioxide = false;
            
            elements.forEach(element => {
                if (!elementsData[element]) return;
                
                const elementInfo = elementsData[element];
                
                if (element === 'Oxygen') {
                    hasOxygen = true;
                    habitabilityScore += 3;
                    findings.push('‚úÖ <strong>Oxygen detected!</strong> Essential for human breathing. This is a great sign!');
                } else if (element === 'Water Vapor') {
                    hasWater = true;
                    habitabilityScore += 3;
                    findings.push('‚úÖ <strong>Water Vapor found!</strong> Water is crucial for all known life forms. Excellent discovery!');
                } else if (element === 'Methane') {
                    hasMethane = true;
                    habitabilityScore += 2;
                    findings.push('üî¨ <strong>Methane detected!</strong> Could indicate biological activity or geological processes.');
                } else if (element === 'Nitrogen') {
                    hasNitrogen = true;
                    habitabilityScore += 1;
                    findings.push('üå°Ô∏è <strong>Nitrogen present</strong> - helps regulate atmospheric temperature and pressure.');
                } else if (element === 'Sulfur Dioxide') {
                    hasSulfurDioxide = true;
                    habitabilityScore -= 2;
                    findings.push('‚ö†Ô∏è <strong>Sulfur Dioxide detected - TOXIC!</strong> Indicates active volcanism. Dangerous for humans without protection.');
                } else if (element === 'Carbon Dioxide') {
                    hasCarbonDioxide = true;
                    habitabilityScore += 1;
                    findings.push('üåç <strong>Carbon Dioxide found</strong> - creates greenhouse effect (traps heat). Too much can make planet too hot.');
                } else if (element === 'Argon') {
                    habitabilityScore += 0;
                    findings.push('üîµ <strong>Argon detected</strong> - inert noble gas, stable but not harmful or helpful for life.');
                }
            });
            
            let conclusion = '';
            let conclusionClass = '';
            let recommendation = '';
            
            if (habitabilityScore >= 5) {
                conclusion = 'üåü <strong>PROMISING for Habitation!</strong><br>This planet shows excellent signs for potential human colonization!';
                conclusionClass = 'habitable';
                recommendation = '‚úÖ <strong>RECOMMENDED for future colonization missions.</strong> The presence of life-supporting elements makes this a prime candidate for establishing a human settlement. Further exploration and detailed surveys are highly recommended!';
            } else if (habitabilityScore >= 3) {
                conclusion = 'üîç <strong>MIXED Characteristics</strong><br>This planet has both promising and concerning features.';
                conclusionClass = 'moderate';
                recommendation = '‚ö†Ô∏è <strong>CONDITIONAL recommendation.</strong> Could be habitable with proper life support systems and protective equipment. More detailed analysis and technology development needed before considering colonization.';
            } else {
                conclusion = '‚ùå <strong>UNSUITABLE for Human Habitation</strong><br>This planet appears too dangerous or lacks essential elements for human life.';
                conclusionClass = 'uninhabitable';
                recommendation = '‚ùå <strong>NOT RECOMMENDED for colonization.</strong> This planet may be useful for scientific research, resource extraction, or as a waypoint, but is not suitable for permanent human settlement without extensive terraforming.';
            }
            
            return {
                findings: findings,
                conclusion: conclusion,
                conclusionClass: conclusionClass,
                recommendation: recommendation,
                habitabilityScore: habitabilityScore
            };
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            createStars();
            drawSpectrum();
        });
    </script>
</body>
</html>

