<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transit Photometry - SABRINA</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        .container {
            position: relative;
            z-index: 2;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            border: 2px solid rgba(100, 255, 218, 0.3);
        }
        
        .header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5em;
            color: #64ffda;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(100, 255, 218, 0.5);
        }
        
        .content-card {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            border: 3px solid rgba(100, 255, 218, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .intro-section {
            margin-bottom: 40px;
        }
        
        .intro-section h2 {
            font-family: 'Orbitron', sans-serif;
            color: #f8b500;
            font-size: 1.8em;
            margin-bottom: 15px;
        }
        
        .intro-section p {
            font-size: 1.1em;
            line-height: 1.8;
            color: #b0bec5;
            margin-bottom: 15px;
        }
        
        .edu-box {
            background: rgba(248, 181, 0, 0.1);
            border-left: 5px solid #f8b500;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .edu-box:hover {
            background: rgba(248, 181, 0, 0.15);
        }
        
        .edu-box h3 {
            font-family: 'Orbitron', sans-serif;
            color: #f8b500;
            margin-bottom: 10px;
        }
        
        .edu-box p {
            color: #b0bec5;
            line-height: 1.6;
        }
        
        .light-curve-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid rgba(100, 255, 218, 0.2);
        }
        
        .light-curve-title {
            font-family: 'Orbitron', sans-serif;
            color: #64ffda;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .light-curve-chart {
            position: relative;
            width: 100%;
            height: 400px;
            background: linear-gradient(90deg, #1a1a2e 0%, #0a0e27 100%);
            border: 2px solid rgba(100, 255, 218, 0.3);
            border-radius: 10px;
            margin: 20px 0;
            overflow: visible;
        }
        
        .chart-grid {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        .grid-line {
            position: absolute;
            background: rgba(100, 255, 218, 0.1);
        }
        
        .grid-line.horizontal {
            width: 100%;
            height: 1px;
        }
        
        .grid-line.vertical {
            width: 1px;
            height: 100%;
        }
        
        .light-curve-line {
            position: absolute;
            bottom: 0;
            width: 2px;
            background: #64ffda;
            transition: all 0.1s;
        }
        
        .transit-dip {
            position: absolute;
            bottom: 0;
            background: rgba(255, 107, 157, 0.3);
            border-top: 2px solid #ff6b9d;
        }
        
        .marker {
            position: absolute;
            top: 0;
            width: 3px;
            height: 100%;
            background: #f8b500;
            cursor: ew-resize;
            z-index: 10;
            box-shadow: 0 0 10px rgba(248, 181, 0, 0.8);
        }
        
        .marker::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -5px;
            width: 13px;
            height: 13px;
            background: #f8b500;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(248, 181, 0, 1);
        }
        
        .marker-label {
            position: absolute;
            top: -30px;
            left: -20px;
            font-size: 0.8em;
            color: #f8b500;
            font-weight: bold;
            white-space: nowrap;
            font-family: 'Orbitron', sans-serif;
        }
        
        .depth-marker {
            position: absolute;
            left: 0;
            width: 100%;
            height: 2px;
            background: #00e676;
            cursor: ns-resize;
            z-index: 10;
            box-shadow: 0 0 10px rgba(0, 230, 118, 0.8);
        }
        
        .depth-marker::before {
            content: '';
            position: absolute;
            left: -6px;
            top: -4px;
            width: 10px;
            height: 10px;
            background: #00e676;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(0, 230, 118, 1);
        }
        
        .depth-label {
            position: absolute;
            left: 10px;
            top: -25px;
            font-size: 0.8em;
            color: #00e676;
            font-weight: bold;
            font-family: 'Orbitron', sans-serif;
        }
        
        .axis-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9em;
            color: #b0bec5;
        }
        
        .measurements-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .measurement-card {
            background: rgba(100, 255, 218, 0.1);
            border: 2px solid rgba(100, 255, 218, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .measurement-label {
            font-family: 'Orbitron', sans-serif;
            color: #64ffda;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        
        .measurement-value {
            font-size: 2em;
            font-weight: bold;
            color: #f8b500;
            font-family: 'Orbitron', sans-serif;
        }
        
        .calculation-result {
            background: rgba(0, 230, 118, 0.2);
            border: 3px solid #00e676;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
            display: none;
        }
        
        .calculation-result.show {
            display: block;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .calculation-result h3 {
            font-family: 'Orbitron', sans-serif;
            color: #00e676;
            font-size: 1.5em;
            margin-bottom: 15px;
        }
        
        .calculation-result p {
            font-size: 1.2em;
            color: #ffffff;
            line-height: 1.8;
        }
        
        .btn {
            padding: 20px 40px;
            font-size: 1.3em;
            font-weight: bold;
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, #00e676, #00bcd4);
            border: none;
            border-radius: 15px;
            color: #0a0e27;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(0, 230, 118, 0.4);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin: 20px 10px;
            display: inline-block;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 230, 118, 0.6);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #64ffda, #00bcd4);
        }
        
        .feedback {
            margin: 20px 0;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.1em;
            text-align: center;
            display: none;
        }
        
        .feedback.show {
            display: block;
        }
        
        .feedback.success {
            background: rgba(0, 230, 118, 0.2);
            border: 2px solid #00e676;
            color: #00e676;
        }
        
        .feedback.info {
            background: rgba(100, 255, 218, 0.2);
            border: 2px solid #64ffda;
            color: #64ffda;
        }
        
        .instructions {
            background: rgba(100, 255, 218, 0.1);
            border: 2px solid rgba(100, 255, 218, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .instructions h3 {
            font-family: 'Orbitron', sans-serif;
            color: #64ffda;
            margin-bottom: 15px;
        }
        
        .instructions ol {
            margin-left: 20px;
            line-height: 2;
        }
        
        .instructions li {
            color: #b0bec5;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <!-- Animated Starfield -->
    <div class="stars" id="stars"></div>
    
    <div class="container">
        <div class="header">
            <h1>üî≠ Transit Photometry Analysis</h1>
            <p style="font-size: 1.2em; color: #b0bec5;">Measure the light curve to determine {{ planet_data.name if planet_data else 'the planet' }}'s size!</p>
        </div>
        
        <div class="content-card">
            <div class="intro-section">
                <h2>üåå What is Transit Photometry?</h2>
                <p>
                    Transit Photometry is a powerful technique used by space telescopes (like Kepler and TESS) to discover exoplanets! 
                    When a planet passes in front of its star, it blocks a tiny fraction of the star's light, creating a "dip" in brightness.
                </p>
                <p>
                    <strong>Your Mission:</strong> Analyze the light curve below to measure the transit and calculate the planet's size relative to its star!
                </p>
            </div>
            
            <div class="edu-box" onclick="this.classList.toggle('expanded')">
                <h3>üí° What is a Light Curve?</h3>
                <p>
                    A light curve is a graph of a star's brightness over time. Any dips in brightness can signal an object (like an exoplanet) 
                    passing in front of it. The depth of the dip tells us how much light is blocked, which reveals the planet's size!
                </p>
            </div>
            
            <div class="edu-box" onclick="this.classList.toggle('expanded')">
                <h3>üî¨ Why Measure the Dip Depth?</h3>
                <p>
                    The depth of the transit dip tells us how much of the star's light is being blocked. A deeper dip means a larger planet. 
                    Since <strong>Area ‚àù Radius¬≤</strong>, we can calculate the planet's size relative to the star by measuring the light blocked. 
                    The formula is: <strong>D ‚âà (R‚Çö/R‚Çõ)¬≤</strong> where D is the dip depth and R‚Çö/R‚Çõ is the planet-to-star radius ratio.
                </p>
            </div>
            
            {% if planet_data %}
            <div class="instructions">
                <h3>üìã How to Measure:</h3>
                <ol style="line-height: 2;">
                    <li><strong>Drag the yellow markers</strong> to mark the <strong>Start</strong> and <strong>End</strong> of the transit dip on the <strong>X-axis (Time)</strong>. <em style="color: #f8b500;">(This measures Transit Duration)</em></li>
                    <li><strong>Drag the green line</strong> to mark the <strong>bottom point (minimum brightness)</strong> of the dip on the <strong>Y-axis (Relative Brightness)</strong>. <em style="color: #00e676;">(This determines Dip Depth)</em></li>
                    <li>Click <strong>"Calculate Planet Size"</strong> to see the final <strong>Radius Ratio</strong> result!</li>
                </ol>
                <div style="margin-top: 15px; padding: 15px; background: rgba(100, 255, 218, 0.1); border-radius: 10px; border-left: 4px solid #64ffda;">
                    <strong style="color: #64ffda;">üí° Tip:</strong> Look for the "dip" in the light curve - that's where the planet is blocking the star's light! The yellow markers should be at the edges of this dip, and the green line should be at the lowest point of the dip.
                </div>
            </div>
            
            <div class="light-curve-container">
                <div class="light-curve-title">üìä Light Curve: Star Brightness Over Time</div>
                <div class="light-curve-chart" id="lightCurveChart">
                    <!-- Light curve will be drawn here by JavaScript -->
                    <div class="chart-grid" id="grid"></div>
                    <div class="marker" id="markerStart" style="left: 0px;">
                        <div class="marker-label">Start</div>
                    </div>
                    <div class="marker" id="markerEnd" style="left: 100px;">
                        <div class="marker-label">End</div>
                    </div>
                    <div class="depth-marker" id="depthMarker" style="bottom: 50%;">
                        <div class="depth-label">Depth</div>
                    </div>
                </div>
                <div class="axis-labels">
                    <span>Time (Hours) ‚Üí</span>
                    <span>‚Üë Relative Brightness (1.0 = 100%)</span>
                </div>
            </div>
            
            <div class="measurements-panel">
                <div class="measurement-card">
                    <div class="measurement-label">‚è±Ô∏è Transit Duration</div>
                    <div class="measurement-value" id="transitDuration">--</div>
                    <div style="font-size: 0.9em; color: #b0bec5; margin-top: 5px;">hours</div>
                </div>
                <div class="measurement-card">
                    <div class="measurement-label">üìâ Dip Depth</div>
                    <div class="measurement-value" id="dipDepth">--</div>
                    <div style="font-size: 0.9em; color: #b0bec5; margin-top: 5px;">(as decimal)</div>
                </div>
                <div class="measurement-card">
                    <div class="measurement-label">üìè Radius Ratio (R‚Çö/R‚Çõ)</div>
                    <div class="measurement-value" id="radiusRatio">--</div>
                    <div style="font-size: 0.9em; color: #b0bec5; margin-top: 5px;">calculated</div>
                </div>
            </div>
            
            <div id="feedback" class="feedback">
                <!-- Feedback will appear here -->
            </div>
            
            <div id="calculationResult" class="calculation-result">
                <h3>üéâ Analysis Complete!</h3>
                <p id="resultText"></p>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="calculateResults()">üîç Calculate Planet Size</button>
                <form method="POST" action="{{ url_for('transit_photometry_complete') }}" style="display: inline;" id="completeForm">
                    <button type="submit" class="btn" id="completeBtn" style="display: none;">‚úÖ Complete Analysis & Continue Mission</button>
                </form>
                <a href="{{ url_for('home') }}" class="btn btn-secondary">‚Üê Back to Mission</a>
            </div>
            {% else %}
            <div class="feedback info show">
                Unable to load transit photometry data. Please return to the mission.
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <a href="{{ url_for('home') }}" class="btn btn-secondary">‚Üê Back to Mission</a>
            </div>
            {% endif %}
        </div>
    </div>
    
    <script>
        // Create animated starfield
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const numStars = 150;
            for (let i = 0; i < numStars; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 3 + 1;
                star.style.width = size + 'px';
                star.style.height = size + 'px';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = (Math.random() * 3 + 2) + 's';
                starsContainer.appendChild(star);
            }
        }
        
        // Transit photometry data
        const planetData = {{ planet_data|tojson if planet_data else '{}' }};
        const transitDepth = planetData.transit_depth || 0.01;
        const transitDuration = planetData.transit_duration_hours || 3.0;
        const expectedRadiusRatio = planetData.planet_star_radius_ratio || 0.1;
        
        let markerStartX = 0;
        let markerEndX = 0;
        let depthY = 0;
        let isDragging = false;
        let dragTarget = null;
        
        function drawLightCurve() {
            const chart = document.getElementById('lightCurveChart');
            if (!chart) return;
            
            // Clear existing elements (but keep markers)
            const existingLines = chart.querySelectorAll('.light-curve-line, .transit-dip, svg, .chart-grid');
            existingLines.forEach(line => line.remove());
            
            const chartWidth = chart.offsetWidth - 20;
            const chartHeight = chart.offsetHeight - 20;
            const timeRange = 24; // 24 hours
            const transitStart = 8; // Transit starts at hour 8
            const transitEnd = transitStart + transitDuration;
            const baseBrightness = 1.0;
            
            // Draw grid
            const grid = document.createElement('div');
            grid.className = 'chart-grid';
            for (let i = 0; i <= 10; i++) {
                const hLine = document.createElement('div');
                hLine.className = 'grid-line horizontal';
                hLine.style.top = (i * 10) + '%';
                grid.appendChild(hLine);
                
                const vLine = document.createElement('div');
                vLine.className = 'grid-line vertical';
                vLine.style.left = (i * 10) + '%';
                grid.appendChild(vLine);
            }
            chart.appendChild(grid);
            
            // Draw light curve using SVG for smoother rendering
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', chartWidth);
            svg.setAttribute('height', chartHeight);
            svg.style.position = 'absolute';
            svg.style.bottom = '0';
            svg.style.left = '10px';
            svg.style.zIndex = '1';
            
            const points = [];
            for (let hour = 0; hour <= timeRange; hour += 0.05) {
                let brightness = baseBrightness;
                
                // Create smooth transit dip
                if (hour >= transitStart && hour <= transitEnd) {
                    // Smooth dip using cosine curve for realistic transit shape
                    const progress = (hour - transitStart) / transitDuration;
                    // Use cosine for smooth ingress/egress
                    if (progress < 0.1) {
                        // Ingress (entering)
                        const ingressProgress = progress / 0.1;
                        const dipAmount = transitDepth * (1 - Math.cos(ingressProgress * Math.PI / 2));
                        brightness = baseBrightness - dipAmount;
                    } else if (progress > 0.9) {
                        // Egress (exiting)
                        const egressProgress = (progress - 0.9) / 0.1;
                        const dipAmount = transitDepth * (1 - Math.cos((1 - egressProgress) * Math.PI / 2));
                        brightness = baseBrightness - dipAmount;
                    } else {
                        // Full transit (flat bottom)
                        brightness = baseBrightness - transitDepth;
                    }
                }
                
                const x = (hour / timeRange) * chartWidth;
                const y = chartHeight - (brightness * chartHeight);
                points.push(`${x},${y}`);
            }
            
            // Create path
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', `M ${points.join(' L ')}`);
            path.setAttribute('stroke', '#64ffda');
            path.setAttribute('stroke-width', '2');
            path.setAttribute('fill', 'none');
            path.setAttribute('style', 'filter: drop-shadow(0 0 3px rgba(100, 255, 218, 0.5));');
            svg.appendChild(path);
            chart.appendChild(svg);
            
            // Highlight transit region
            const dipRegion = document.createElement('div');
            dipRegion.className = 'transit-dip';
            const dipX = (transitStart / timeRange) * chartWidth;
            const dipWidth = (transitDuration / timeRange) * chartWidth;
            const dipHeight = (transitDepth * chartHeight);
            dipRegion.style.left = dipX + 'px';
            dipRegion.style.width = dipWidth + 'px';
            dipRegion.style.height = dipHeight + 'px';
            dipRegion.style.bottom = (chartHeight - (baseBrightness * chartHeight)) + 'px';
            chart.appendChild(dipRegion);
            
            // Initialize markers
            initializeMarkers();
        }
        
        function initializeMarkers() {
            const chart = document.getElementById('lightCurveChart');
            const chartWidth = chart.offsetWidth - 20;
            const chartHeight = chart.offsetHeight - 20;
            const timeRange = 24;
            const transitStart = 8;
            const transitEnd = transitStart + transitDuration;
            
            // Set initial marker positions
            markerStartX = (transitStart / timeRange) * chartWidth;
            markerEndX = (transitEnd / timeRange) * chartWidth;
            depthY = chartHeight - ((1.0 - transitDepth) * chartHeight);
            
            updateMarkerPositions();
        }
        
        function updateMarkerPositions() {
            const chart = document.getElementById('lightCurveChart');
            const chartHeight = chart.offsetHeight - 20;
            
            document.getElementById('markerStart').style.left = markerStartX + 'px';
            document.getElementById('markerEnd').style.left = markerEndX + 'px';
            document.getElementById('depthMarker').style.bottom = (chartHeight - depthY) + 'px';
            
            updateMeasurements();
        }
        
        function updateMeasurements() {
            const chart = document.getElementById('lightCurveChart');
            const chartWidth = chart.offsetWidth - 20;
            const chartHeight = chart.offsetHeight - 20;
            const timeRange = 24;
            const baseBrightness = 1.0;
            
            // Calculate transit duration
            const startHour = (markerStartX / chartWidth) * timeRange;
            const endHour = (markerEndX / chartWidth) * timeRange;
            const duration = Math.abs(endHour - startHour);
            
            // Calculate dip depth
            const brightnessAtDepth = 1.0 - ((chartHeight - depthY) / chartHeight);
            const depth = Math.max(0, Math.min(1.0, baseBrightness - brightnessAtDepth));
            
            // Calculate radius ratio: D ‚âà (Rp/Rs)¬≤, so Rp/Rs ‚âà ‚àöD
            const radiusRatio = Math.sqrt(depth);
            
            // Update display
            document.getElementById('transitDuration').textContent = duration.toFixed(2);
            document.getElementById('dipDepth').textContent = depth.toFixed(4);
            document.getElementById('radiusRatio').textContent = radiusRatio.toFixed(4);
        }
        
        function setupDragging() {
            const chart = document.getElementById('lightCurveChart');
            const chartWidth = chart.offsetWidth - 20;
            const chartHeight = chart.offsetHeight - 20;
            
            const markerStart = document.getElementById('markerStart');
            const markerEnd = document.getElementById('markerEnd');
            const depthMarker = document.getElementById('depthMarker');
            
            function startDrag(e, target) {
                isDragging = true;
                dragTarget = target;
                e.preventDefault();
            }
            
            function drag(e) {
                if (!isDragging || !dragTarget) return;
                
                const rect = chart.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = rect.bottom - e.clientY;
                
                if (dragTarget === markerStart || dragTarget === markerEnd) {
                    const newX = Math.max(0, Math.min(chartWidth, x));
                    if (dragTarget === markerStart) {
                        markerStartX = newX;
                        if (markerStartX >= markerEndX) markerStartX = markerEndX - 5;
                    } else {
                        markerEndX = newX;
                        if (markerEndX <= markerStartX) markerEndX = markerStartX + 5;
                    }
                } else if (dragTarget === depthMarker) {
                    const newY = Math.max(0, Math.min(chartHeight, y));
                    depthY = newY;
                }
                
                updateMarkerPositions();
            }
            
            function stopDrag() {
                isDragging = false;
                dragTarget = null;
            }
            
            markerStart.addEventListener('mousedown', (e) => startDrag(e, markerStart));
            markerEnd.addEventListener('mousedown', (e) => startDrag(e, markerEnd));
            depthMarker.addEventListener('mousedown', (e) => startDrag(e, depthMarker));
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
        }
        
        function calculateResults() {
            const chart = document.getElementById('lightCurveChart');
            const chartWidth = chart.offsetWidth - 20;
            const chartHeight = chart.offsetHeight - 20;
            const timeRange = 24;
            const baseBrightness = 1.0;
            
            // Get measurements
            const startHour = (markerStartX / chartWidth) * timeRange;
            const endHour = (markerEndX / chartWidth) * timeRange;
            const duration = Math.abs(endHour - startHour);
            const brightnessAtDepth = 1.0 - ((chartHeight - depthY) / chartHeight);
            const depth = Math.max(0, Math.min(1.0, baseBrightness - brightnessAtDepth));
            const radiusRatio = Math.sqrt(depth);
            
            // Calculate accuracy
            const depthError = Math.abs(depth - transitDepth) / transitDepth * 100;
            const ratioError = Math.abs(radiusRatio - expectedRadiusRatio) / expectedRadiusRatio * 100;
            
            const feedback = document.getElementById('feedback');
            const resultDiv = document.getElementById('calculationResult');
            const resultText = document.getElementById('resultText');
            
            // Check if measurements are reasonable
            if (depth < 0.001) {
                feedback.className = 'feedback info show';
                feedback.innerHTML = `
                    <strong>üí° Hint from SABRINA:</strong><br>
                    Your measurement seems too shallow. Remember, a transit is when the planet blocks a noticeable amount of light. 
                    Try placing your depth line at the maximum light drop (the bottom of the dip) to find the planet's true size!
                `;
                return;
            }
            
            if (duration < 0.5 || duration > 10) {
                feedback.className = 'feedback info show';
                feedback.innerHTML = `
                    <strong>üí° Hint:</strong><br>
                    Your transit duration seems unusual. Make sure your markers are at the start and end of the brightness dip, 
                    not outside the transit region!
                `;
                return;
            }
            
            // Show results
            let accuracyMessage = '';
            if (ratioError < 5) {
                accuracyMessage = `üéâ <strong>Excellent accuracy!</strong> Your measurement was within ${ratioError.toFixed(1)}% of the expected value!`;
            } else if (ratioError < 15) {
                accuracyMessage = `‚úÖ <strong>Good measurement!</strong> Your result was within ${ratioError.toFixed(1)}% of the expected value.`;
            } else {
                accuracyMessage = `üìä <strong>Close enough!</strong> Your measurement was within ${ratioError.toFixed(1)}% of the expected value. Try to be more precise next time!`;
            }
            
            resultText.innerHTML = `
                <strong>Data Collected:</strong> Calculated radius of <strong>{{ planet_data.name if planet_data else 'the planet' }}</strong> 
                is <strong>${radiusRatio.toFixed(4)}</strong> times the size of its star.<br><br>
                <strong>R‚Çö/R‚Çõ = ${radiusRatio.toFixed(4)}</strong><br><br>
                ${accuracyMessage}<br><br>
                This confirms {{ planet_data.name if planet_data else 'the planet' }}'s status as a <strong>{{ planet_data.type if planet_data else 'planet' }}</strong>!
            `;
            
            resultDiv.classList.add('show');
            document.getElementById('completeBtn').style.display = 'inline-block';
            
            // Scroll to result
            setTimeout(() => {
                resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 300);
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            createStars();
            drawLightCurve();
            setupDragging();
        });
        
        // Handle window resize
        window.addEventListener('resize', function() {
            drawLightCurve();
            setupDragging();
        });
    </script>
</body>
</html>

